<div class="os-view-container" *ngIf="ordemServico">

  <!-- Header com Status -->
  <div class="flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="text-900 mb-2">{{ ordemServico.numero }}</h4>
      <p-tag
        [value]="getStatusLabel(ordemServico.status)"
        [severity]="getStatusColor(ordemServico.status)"
        styleClass="text-lg">
      </p-tag>
    </div>
    <div class="text-right">
      <div class="text-600 text-sm">Valor Total</div>
      <div class="text-900 text-2xl font-bold">{{ formatarValor(ordemServico.valorTotal) }}</div>
    </div>
  </div>

  <div class="grid">

    <!-- Informações do Projeto e Cliente -->
    <div class="col-12 lg:col-6">
      <p-card header="Projeto e Cliente" styleClass="h-full">
        <div class="grid">
          <div class="col-12">
            <label class="text-600 font-medium text-sm">Projeto:</label>
            <div class="text-900 font-medium">{{ ordemServico.projeto?.nome || 'N/A' }}</div>
            <div class="text-600 text-sm mt-1" *ngIf="ordemServico.projeto?.descricao">
              {{ ordemServico.projeto.descricao }}
            </div>
          </div>

          <div class="col-12 mt-3">
            <label class="text-600 font-medium text-sm">Cliente:</label>
            <div class="text-900 font-medium">{{ ordemServico.cliente?.nome || 'N/A' }}</div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Datas -->
    <div class="col-12 lg:col-6">
      <p-card header="Cronograma" styleClass="h-full">
        <div class="grid">
          <div class="col-6">
            <label class="text-600 font-medium text-sm">Data Emissão:</label>
            <div class="text-900">{{ formatarData(ordemServico.dataEmissao) }}</div>
          </div>

          <div class="col-6">
            <label class="text-600 font-medium text-sm">Prev. Início:</label>
            <div class="text-900">{{ formatarData(ordemServico.dataPrevistaInicio) }}</div>
          </div>

          <div class="col-6">
            <label class="text-600 font-medium text-sm">Prev. Conclusão:</label>
            <div class="text-900">{{ formatarData(ordemServico.dataPrevistaConclusao) }}</div>
          </div>

          <div class="col-6">
            <label class="text-600 font-medium text-sm">Data Início:</label>
            <div class="text-900">{{ formatarData(ordemServico.dataInicio) }}</div>
          </div>

          <div class="col-6" *ngIf="ordemServico.dataConclusao">
            <label class="text-600 font-medium text-sm">Data Conclusão:</label>
            <div class="text-900">{{ formatarData(ordemServico.dataConclusao) }}</div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Responsável -->
    <div class="col-12 lg:col-6" *ngIf="ordemServico.responsavel">
      <p-card header="Responsável">
        <div class="flex align-items-center">
          <i class="pi pi-user text-2xl text-primary mr-3"></i>
          <div>
            <div class="text-900 font-medium">{{ ordemServico.responsavel }}</div>
            <div class="text-600 text-sm">Responsável pela execução</div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Observações -->
    <div class="col-12" *ngIf="ordemServico.observacoes || ordemServico.instrucoesTecnicas">
      <p-card header="Observações e Instruções">
        <div class="grid">
          <div class="col-12 md:col-6" *ngIf="ordemServico.observacoes">
            <h6 class="text-900 mb-2">
              <i class="pi pi-comment mr-2"></i>
              Observações Gerais
            </h6>
            <div class="text-600 line-height-3">{{ ordemServico.observacoes }}</div>
          </div>

          <div class="col-12 md:col-6" *ngIf="ordemServico.instrucoesTecnicas">
            <h6 class="text-900 mb-2">
              <i class="pi pi-cog mr-2"></i>
              Instruções Técnicas
            </h6>
            <div class="text-600 line-height-3">{{ ordemServico.instrucoesTecnicas }}</div>
          </div>
        </div>
      </p-card>
    </div>

    <!-- Itens da OS (se existirem) -->
    <div class="col-12" *ngIf="ordemServico.itens && ordemServico.itens.length > 0">
      <p-card header="Itens da Ordem de Serviço">
        <p-table [value]="ordemServico.itens" styleClass="p-datatable-sm">
          <ng-template pTemplate="header">
            <tr>
              <th>Produto</th>
              <th>Quantidade</th>
              <th>Valor Unitário</th>
              <th>Valor Total</th>
              <th>Observações</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-item>
            <tr>
              <td>{{ item.produto?.nome || 'N/A' }}</td>
              <td>{{ item.quantidade }}</td>
              <td>{{ formatarValor(item.valorUnitario) }}</td>
              <td>{{ formatarValor(item.valorTotal) }}</td>
              <td>{{ item.observacoes || '-' }}</td>
            </tr>
          </ng-template>
        </p-table>
      </p-card>
    </div>

    <!-- Auditoria -->
    <div class="col-12">
      <p-card header="Informações de Auditoria">
        <div class="grid">
          <div class="col-6">
            <label class="text-600 font-medium text-sm">Data Criação:</label>
            <div class="text-900">{{ formatarDataHora(ordemServico.dataCriacao) }}</div>
          </div>

          <div class="col-6">
            <label class="text-600 font-medium text-sm">Última Atualização:</label>
            <div class="text-900">{{ formatarDataHora(ordemServico.dataAtualizacao) }}</div>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Botão Fechar -->
  <div class="flex justify-content-end mt-4">
    <p-button
      label="Fechar"
      icon="pi pi-times"
      styleClass="p-button-text"
      (onClick)="onClose()">
    </p-button>
  </div>
</div>

